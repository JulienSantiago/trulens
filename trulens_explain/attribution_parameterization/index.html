
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../quickstart/">
      
      
        <link rel="next" href="../api/attribution/">
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.16">
    
    
      
        <title>Attributions for Different Use Cases - TruLens</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/cover.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="trulens" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#attribution-parameterization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TruLens" class="md-header__button md-logo" aria-label="TruLens" data-md-component="logo">
      
  <img src="../../img/squid.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TruLens
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Attributions for Different Use Cases
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TruLens" class="md-nav__button md-logo" aria-label="TruLens" data-md-component="logo">
      
  <img src="../../img/squid.png" alt="logo">

    </a>
    TruLens
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../welcome/" class="md-nav__link">
        Welcome to TruLens!
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Eval
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Eval
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Feedback Functions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Feedback Functions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/feedback_functions/" class="md-nav__link">
        Feedback Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
          Smoke Tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Smoke Tests
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/pr_relevance_smoke_tests/" class="md-nav__link">
        Prompt Response Relevance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/qs_relevance_smoke_tests/" class="md-nav__link">
        Question Statement Relevance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/api/tru/" class="md-nav__link">
        Tru
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/api/trubasicapp/" class="md-nav__link">
        TruBasicApp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/api/truchain/" class="md-nav__link">
        TruChain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/api/trullama/" class="md-nav__link">
        TruLlama
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trulens_eval/api/feedback/" class="md-nav__link">
        Feedback Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Explain
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Explain
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Attributions for Different Use Cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Attributions for Different Use Cases
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#attribution-parameterization" class="md-nav__link">
    Attribution Parameterization
  </a>
  
    <nav class="md-nav" aria-label="Attribution Parameterization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-definitions-and-terminology" class="md-nav__link">
    Basic Definitions and Terminology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-trulens" class="md-nav__link">
    How to use TruLens?
  </a>
  
    <nav class="md-nav" aria-label="How to use TruLens?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-1-input-output-cut-basic-configuration" class="md-nav__link">
    Case 1: Input-Output cut (Basic configuration)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2-the-qoi-cut" class="md-nav__link">
    Case 2: The QoI Cut
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-3-the-attribution-cut" class="md-nav__link">
    Case 3: The Attribution Cut
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-use-cases" class="md-nav__link">
    Advanced Use Cases
  </a>
  
    <nav class="md-nav" aria-label="Advanced Use Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-4-the-distribution-of-interest-doi-cut-explanation-flexibility" class="md-nav__link">
    Case 4: The Distribution of Interest (DoI) Cut / Explanation flexibility
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-5-internal-explanations" class="md-nav__link">
    Case 5: Internal explanations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-6-your-baseline-happens-at-a-different-layer-than-your-sampling" class="md-nav__link">
    Case 6: Your baseline happens at a different layer than your sampling.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-7-putting-it-together-the-most-complex-case-we-can-perform-with-trulens" class="md-nav__link">
    Case 7: Putting it together - The most complex case we can perform with TruLens
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-definitions" class="md-nav__link">
    Advanced Definitions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/attribution/" class="md-nav__link">
        Attribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/model_wrappers/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/slices/" class="md-nav__link">
        Slices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/quantities/" class="md-nav__link">
        Quantities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/distributions/" class="md-nav__link">
        Distributions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/visualizations/" class="md-nav__link">
        Visualizations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#attribution-parameterization" class="md-nav__link">
    Attribution Parameterization
  </a>
  
    <nav class="md-nav" aria-label="Attribution Parameterization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-definitions-and-terminology" class="md-nav__link">
    Basic Definitions and Terminology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-trulens" class="md-nav__link">
    How to use TruLens?
  </a>
  
    <nav class="md-nav" aria-label="How to use TruLens?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-1-input-output-cut-basic-configuration" class="md-nav__link">
    Case 1: Input-Output cut (Basic configuration)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2-the-qoi-cut" class="md-nav__link">
    Case 2: The QoI Cut
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-3-the-attribution-cut" class="md-nav__link">
    Case 3: The Attribution Cut
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-use-cases" class="md-nav__link">
    Advanced Use Cases
  </a>
  
    <nav class="md-nav" aria-label="Advanced Use Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-4-the-distribution-of-interest-doi-cut-explanation-flexibility" class="md-nav__link">
    Case 4: The Distribution of Interest (DoI) Cut / Explanation flexibility
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-5-internal-explanations" class="md-nav__link">
    Case 5: Internal explanations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-6-your-baseline-happens-at-a-different-layer-than-your-sampling" class="md-nav__link">
    Case 6: Your baseline happens at a different layer than your sampling.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-7-putting-it-together-the-most-complex-case-we-can-perform-with-trulens" class="md-nav__link">
    Case 7: Putting it together - The most complex case we can perform with TruLens
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-definitions" class="md-nav__link">
    Advanced Definitions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Attributions for Different Use Cases</h1>

<h2 id="attribution-parameterization">Attribution Parameterization<a class="headerlink" href="#attribution-parameterization" title="Permanent link">&para;</a></h2>
<p>Attributions for different models and use cases can range from simple to more complex. This page provides guidelines on how to set various attribution parameters to achieve your LLM explainability goals.</p>
<h3 id="basic-definitions-and-terminology">Basic Definitions and Terminology<a class="headerlink" href="#basic-definitions-and-terminology" title="Permanent link">&para;</a></h3>
<p><strong>What is a tensor?</strong>
A tensor is a multidimensional object that can be model inputs, or layer activations.</p>
<p><strong>What is a layer?</strong>
A layer is a set of neurons that can be thought of as a function on input tensors. Layer inputs are tensors. Layer outputs are modified tensors.</p>
<p><strong>What are anchors?</strong>
Anchors are ways of specifying which tensors you want. You may want the input tensor of a layer, or the output tensor of a layer. </p>
<blockquote>
<p>E.g. Say you have a concat layer and you want to explain the 2 concatenated tensors. The concat operation is not usually a layer tracked by the model. If you try the 'in' anchor of the layer after the operation, you get a single tensor with all the information you need.</p>
</blockquote>
<p><strong>What is a Quantity of Interest (QoI)?</strong>
A QoI is a scalar number that is being explained. </p>
<blockquote>
<p>E.g. With saliency maps, you get <code>dx/dy</code> (i.e. the effect of input on output). <code>y</code> in this case is the QoI scalar. It is usually the output of a neuron, but could be a sum of multiple neurons.</p>
</blockquote>
<p><strong>What is an attribution?</strong>
An attribution is a numerical value associated with every element in a tensor that explains a QoI. </p>
<blockquote>
<p>E.g. With saliency maps, you get <code>dx/dy</code>. <code>x</code> is the associated tensor. The entirety of <code>dx/dy</code> is the explanation.</p>
</blockquote>
<p><strong>What are cuts?</strong>
Cuts are tensors that cut a network into two parts. They are composed of a layer and an anchor.</p>
<p><strong>What are slices?</strong>
Slices are two cuts leaving a <code>slice</code> of the network. The attribution will be on the first cut, explaining the QoI on the second cut of the slice.</p>
<blockquote>
<p>E.g. With saliency maps, the TruLens slice would be AttributionCut: <code>Cut(x)</code> to QoICut: <code>Cut(y)</code>, denoted by <code>Slice(Cut(x),Cut(y))</code>.</p>
</blockquote>
<h3 id="how-to-use-trulens">How to use TruLens?<a class="headerlink" href="#how-to-use-trulens" title="Permanent link">&para;</a></h3>
<p>This section will cover different use cases from the most basic to the most complex. For the following use cases, it may help to refer to <a href="#summary">Summary</a>.</p>
<h4 id="case-1-input-output-cut-basic-configuration">Case 1: Input-Output cut (Basic configuration)<a class="headerlink" href="#case-1-input-output-cut-basic-configuration" title="Permanent link">&para;</a></h4>
<p><strong>Use case:</strong> Explain the input given the output.<br />
<strong>Cuts needed:</strong> TruLens defaults.<br />
<strong>Attribution Cut</strong> (The tensor we would like to assign importance) → InputCut (model args / kwargs)<br />
<strong>QoI Cut</strong> (The tensor that we are interested to explain) → OutputCut</p>
<h4 id="case-2-the-qoi-cut">Case 2: The QoI Cut<a class="headerlink" href="#case-2-the-qoi-cut" title="Permanent link">&para;</a></h4>
<p>Now suppose you want to explain some internal (intermediate) layer’s output (i.e. how the input is affecting the output at some intermediate layer).</p>
<p><strong>Use case:</strong> Explain something that isn't the default model output. </p>
<blockquote>
<p>E.g. If you want to explain a logit layer instead of the probit (final) layer.</p>
</blockquote>
<p><strong>Cuts needed:</strong> As you want to explain something different than the default output, you need to change the QoI from the default to the layer that you are interested.<br />
<strong>Attribution Cut</strong> → InputCut<br />
<strong>QoI Cut</strong> → Your logit layer, anchor:'out'</p>
<h4 id="case-3-the-attribution-cut">Case 3: The Attribution Cut<a class="headerlink" href="#case-3-the-attribution-cut" title="Permanent link">&para;</a></h4>
<p>Now suppose you want to know the attribution of some internal layer on the final output. </p>
<p><strong>Use cases:</strong> </p>
<ul>
<li>As a preprocessing step, you drop a feature, so do not need attributions on that.</li>
<li>For PyTorch models, model inputs are not tensors, so you'd want the 'in' anchor of the first layer.  </li>
</ul>
<p><strong>Cuts needed:</strong> As you want to know the affect of some other layer rather than the input layer, you need to customize the attribution cut.<br />
<strong>Model inputs</strong> → InputCut<br />
<strong>Attribution Cut</strong> → Your attribution layer (The layer you want to assign importance/attributions with respect to output), anchor:'in'<br />
<strong>QoI Cut</strong> → OutputCut</p>
<h3 id="advanced-use-cases">Advanced Use Cases<a class="headerlink" href="#advanced-use-cases" title="Permanent link">&para;</a></h3>
<p>For the following use cases, it may help to refer to <a href="#advanced-definitions">Advanced Definitions</a>.</p>
<h4 id="case-4-the-distribution-of-interest-doi-cut-explanation-flexibility">Case 4: The Distribution of Interest (DoI) Cut / Explanation flexibility<a class="headerlink" href="#case-4-the-distribution-of-interest-doi-cut-explanation-flexibility" title="Permanent link">&para;</a></h4>
<p>Usually, we explain the output with respect to each point in the input. All cases up to now were using a default called <code>PointDoI</code>. Now, suppose you want to explain using an aggregate over samples of points.  </p>
<p><strong>Use case:</strong> You want to perform approaches like Integrated Gradients, Grad-CAM, Shapley values instead of saliency maps. These only differ by sampling strategies.</p>
<blockquote>
<p>E.g. Integrated Gradients is a sample from a straight line from a baseline to a value.</p>
</blockquote>
<p><strong>Cuts needed:</strong> Define a DoI that samples from the default attribution cut.<br />
<strong>Model inputs</strong> → InputCut<br />
<strong>DoI/Attribution Cut</strong> → Your baseline/DoI/attribution layer, anchor:'in'<br />
<strong>QoI Cut</strong> → OutputCut</p>
<h4 id="case-5-internal-explanations">Case 5: Internal explanations<a class="headerlink" href="#case-5-internal-explanations" title="Permanent link">&para;</a></h4>
<p><strong>Use case:</strong> You want to explain an internal layer. Methods like Integrated Gradients are a DoI on the baseline to the value, but it is located on the layer the baseline is defined.
If you want to explain an internal layer, you do not move the DoI layer.<br />
<strong>Cuts needed:</strong> Attribution layer different from DoI.<br />
<strong>Model inputs</strong> → InputCut<br />
<strong>DoI Cut</strong> → Your baseline/DoI layer, anchor:'in'<br />
<strong>Attribution Cut</strong> → Your internal attribution layer, anchor:'out' or 'in'<br />
<strong>QoI Cut</strong> → OutputCut</p>
<h4 id="case-6-your-baseline-happens-at-a-different-layer-than-your-sampling">Case 6: Your baseline happens at a different layer than your sampling.<a class="headerlink" href="#case-6-your-baseline-happens-at-a-different-layer-than-your-sampling" title="Permanent link">&para;</a></h4>
<p><strong>Use Case:</strong> in NLP, baselines are tokens, but the interpolation is on the embedding layer.<br />
<strong>Cuts needed:</strong> Baseline different from DoI.<br />
<strong>Model inputs</strong> → InputCut<br />
<strong>Baseline Cut</strong> → Tokens, anchor:'out'<br />
<strong>DoI/Attribution Cut</strong> → Embeddings, anchor:'out'<br />
<strong>QoI Cut</strong> → OutputCut</p>
<h4 id="case-7-putting-it-together-the-most-complex-case-we-can-perform-with-trulens">Case 7: Putting it together - The most complex case we can perform with TruLens<a class="headerlink" href="#case-7-putting-it-together-the-most-complex-case-we-can-perform-with-trulens" title="Permanent link">&para;</a></h4>
<p><strong>Use Case:</strong> Internal layer explanations of NLP, on the logit layer of a model with probit outputs.<br />
<strong>Model inputs</strong> → InputCut<br />
<strong>Baseline Cut</strong> → Tokens, anchor:'out'<br />
<strong>DoI Cut</strong> → Embeddings, anchor:'out'<br />
<strong>Attribution Cut</strong> → Internal layer, anchor:'out'<br />
<strong>QoI Cut</strong> → Logit layer, anchor:'out'</p>
<h3 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h3>
<p><strong>InputCut</strong> is model args / kwargs.<br />
<strong>OutputCut</strong> is the model output.</p>
<p><strong>Baseline Cut</strong> is the tensor associated with the Integrated Gradients baseline. Can be the InputCut or later.<br />
<strong>DoI Cut</strong> is the tensor associated with explanation sampling. Can be the BaselineCut or later.<br />
<strong>Attribution Cut</strong> is the tensor that should be explained. Can be the DoICut or later.<br />
<strong>QoI Cut</strong> is what is being explained with a QoI. Must be after the AttributionCut.</p>
<h3 id="advanced-definitions">Advanced Definitions<a class="headerlink" href="#advanced-definitions" title="Permanent link">&para;</a></h3>
<p><strong>What is a Distribution of Interest (DoI)?</strong></p>
<p>The distribution of interest is a concept of aggregating attributions over a sample or distribution. </p>
<ul>
<li>Grad-CAM (<a href="https://ieeexplore.ieee.org/document/8237336">Paper</a>, <a href="https://github.com/jacobgil/pytorch-grad-cam">GitHub</a>, <a href="https://jacobgil.github.io/pytorch-gradcam-book/introduction.html">Docs</a>) does this over a Gaussian distribution of inputs. </li>
<li>Shapley values (<a href="https://github.com/slundberg/shap">GitHub</a>, <a href="https://shap.readthedocs.io/en/latest/">Docs</a>) do this over different background data. </li>
<li>Integrated Gradients (<a href="https://arxiv.org/abs/1703.01365">Paper</a>, <a href="https://www.tensorflow.org/tutorials/interpretability/integrated_gradients">Tutorial</a>) do this over an interpolation from a baseline to the input.</li>
</ul>
<p><strong><em>How does this relate to the Attribution Cut?</em></strong></p>
<p>The sample or distributions are taken at a place that is humanly considered the input, even if this differs from the programmatic model input.</p>
<p>For attributions, all parts of a network can have an attribution towards the QoI. The most common use case is to explain the tensors that are also humanly considered the input (which is where the DoI occurs).</p>
<p><strong><em>How does this relate to the Baseline Cut?</em></strong></p>
<p>The Baseline Cut is only applicable to the Integrated Gradients method. It is also only needed when there is no mathematical way to interpolate the baseline to the input.</p>
<blockquote>
<p>E.g. if the input is <code>'Hello'</code>, but the baseline is a <code>'[MASK]'</code> token, we cannot interpolate that. We define the baseline at the token layer, but interpolate on a numeric layer like the embeddings.</p>
</blockquote>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a51614de.min.js"></script>
      
        
          <script src="../../javascript/config.js"></script>
        
      
        
          <script src="../../javascript/app.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="../../javascript/tex-mml-chtml-3.0.0.js"></script>
        
      
        
          <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
        
      
    
  </body>
</html>